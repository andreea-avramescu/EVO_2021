# -*- coding: utf-8 -*-
"""
Created on Tue Oct 13 18:59:24 2020

@author: andre
"""

# Import packages 
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

import random
import operator

import copy
from collections import defaultdict
import math


# Import modules
from coverage import best_coverage
from coverage import stochastic_coverage

from distances import L2_distance
from distances import haversine

from radiuses import within_shelflife

from Solution import Solution

############################### HYPERPARAMETERS ##############################
##############################################################################

# INSERT SHELF LIFE HERE (in hours)
SHELF_LIFE = 12

POPULATION = 100
PARENTS = math.ceil(POPULATION/4)

DIST = haversine
SPEED = 110       # in km

##############################################################################
##############################################################################


# from hospitals_allocation import Hospital

from NSGA_II import appendCryoSol
from NSGA_II import createManuSol
from NSGA_II import initialPopulation
from NSGA_II import dominates
from NSGA_II import sortNondominated
from NSGA_II import CrowingDist
from NSGA_II import fitnessSolutions
from NSGA_II import selection
from NSGA_II import breed
from NSGA_II import breedPopulation
from NSGA_II import mutate
from NSGA_II import mutatePopulation
from NSGA_II import nextGeneration
from NSGA_II import NSGAII

from pareto_solutions import unique_sol

# Hospitals allocation
class Hosp:
    def __init__(self, x, y, demand):
        self.x = x
        self.y = y
        self.demand = demand
        
        self.time = 0.0
        self.cost = 0.0
        
        #self.covered = True
        self.cryo = None
        self.manu = None

    def distance(self, p2, func = haversine):
        return func(self.x, self.y, p2.x, p2.y)

    def __repr__(self):
        return "(" + str(self.x) + "," + str(self.y) + ")"

    def preference(self, loc_list, func = haversine):
        locs = np.array(loc_list)

        H_x = np.full(len(locs), self.x)
        H_y = np.full(len(locs), self.y)
        L_x = loc_array[locs,0]  # longitude
        L_y = loc_array[locs,1]  # latitude

        dist  = func(H_x,H_y,L_x,L_y)

        return locs[np.argsort(dist)]
    
# Read "treatment_centers.csv". This file has the following information:
    # 1. Name of the treatment center;
    # 2. Latitude and Logitude (as 2 different columns) of the above mentioned treatment centers;
    # 3. Demand allocated to each treatment center 
hospitals = pd.read_csv('treatment_centers.csv') # turn into array
hospitals_array = np.array(hospitals[['Longitude','Latitude','Demand']])  # Hospital names are irrelevant

hospitals.head()

# Read "1000_largest_us_cities_raw_cost.csv". This file has the following information:
    # 1. 1000 candidate locations for the manufacturing and cryopreservation facilities;
        # - these were chosen based on the 1000 biggest cities in the USA;
    # 2. Rank (i.e. this is the rank by size) and population size for each of the candidate locations;
    # 3. State within each city is located; 
    # 4. Latitude and Logitude (as 2 separate columns) for each of the candidate locations; 
    # 5. The cost/order calculated for each of the candidate locations;
        # - this is random at this stage and calculated at state level rather than candidate location; 
locations = pd.read_csv('1000_largest_us_cities_raw_cost.csv')
locations.head()

# Create construction costs per State for MANU and CRYO
    # Construction cost is created randomly between 700k and 1mil for manufacturing and 
    # between 100k and 250k for cryopreservation
construction_df = pd.DataFrame(locations.State.unique(),columns=['State'])
construction_df['Constr_manu'] = np.random.randint(700,1000, size = len(construction_df))*1000
construction_df['Constr_cryo'] = np.random.randint(100,250, size = len(construction_df))*1000

# Merge random construction data with locations dataframe and sort by index; drop index
locations = pd.merge(locations.reset_index(),construction_df,
                     on = 'State').sort_values(['index']).drop(columns = ['index']).reset_index(drop = True)

# turn into array; City, Rank, State, and Population are not relevant anymore
loc_array = np.array(locations[['Longitude','Latitude','Cost_order','Constr_manu','Constr_cryo']])
locations.head()

road_network = [[789, 976, 561, 319, 516, 445, 485], [279, 506, 138, 823, 243, 676, 590], [219, 133, 878, 280], [641, 800, 73, 796, 381, 846, 804], [911, 824, 705, 926, 223, 79, 826], [209, 784, 437, 859], [928, 248, 941, 193, 888], [755, 815, 296, 775, 479, 304, 835], [458, 579, 461, 55, 92, 59, 417], [945, 96, 525, 330, 23, 249, 753, 371, 38, 935], [797, 583, 679], [460, 573, 463, 415], [709, 542, 327, 988, 751], [75, 741, 977], [776, 425, 686, 537, 36, 179], [658, 27, 809, 646, 239], [873, 366, 704], [183, 516, 485, 815, 282, 730, 408], [21, 925, 148, 211, 837, 528], [328, 706, 332, 655, 872, 116], [593, 621, 302, 482, 361], [242, 925, 18, 148], [966, 638, 892, 716, 906, 261, 305, 56], [96, 51, 9, 249], [703, 643, 104], [339, 553, 156, 825, 144, 885, 660, 727, 304, 835], [143, 735, 157, 124, 299, 389], [646, 982, 15, 239, 644, 466], [933, 386, 390, 996, 412, 721, 480, 464, 626, 182], [125, 260, 467], [661, 355, 311, 830, 951], [580, 772, 273, 797, 679], [350, 407, 287, 368, 530, 319, 149], [590, 666, 972, 118], [968, 468, 241, 112, 94], [426, 360, 851, 446, 388, 449], [425, 686, 14, 37, 520, 360, 42, 941, 179, 449], [110, 840, 686, 36, 520], [934, 249, 910, 323, 9, 935, 52], [684, 263, 891, 986, 107], [697, 193, 584, 80, 840], [300, 442, 731, 748, 788], [191, 36, 360, 821, 881, 941], [601, 707, 971, 275, 236], [196, 241, 152, 633, 677, 509, 354], [695, 150, 802], [367, 630, 395, 629, 314, 557], [345, 342, 691, 115, 699], [343, 212, 50, 580], [237, 721, 475, 813, 372, 811, 801], [956, 273, 212, 48, 455, 580], [96, 23, 330, 322, 993, 473, 249, 979], [605, 970, 76, 723, 323, 38, 935, 420, 557], [338, 546, 188, 428, 418], [373, 877, 275, 138, 971], [458, 439, 611, 8, 378, 417], [432, 720, 476, 443, 261, 351, 278, 22, 318, 906], [424, 276, 614, 613, 499, 693], [680, 487, 399, 899, 331, 201, 59, 717, 406], [717, 461, 58, 406, 8, 92], [996, 798, 382, 587, 692, 671], [444, 229, 400, 857, 559, 213, 363, 472], [903, 722, 391, 931], [407, 287, 632, 352, 438], [251, 700, 844, 582, 519, 404], [866, 308, 165, 135, 855, 233, 289], [447, 744, 827, 788, 748], [211, 653, 496, 865], [470, 635, 675, 154, 251], [540, 102, 652, 990, 852, 853, 186, 353, 569], [421, 764, 215], [859, 362, 544, 440, 126, 599, 742, 850], [769, 854, 298, 429, 317, 598, 108], [641, 754, 3, 939, 800, 539], [173, 640, 279, 639, 250], [13, 741, 910, 698, 977, 708, 826, 683], [783, 685, 983, 484, 379, 970, 52, 723], [99, 353, 145, 409, 740, 569], [364, 576, 611, 689], [826, 977, 886, 926, 760, 4, 873], [398, 917, 234, 405, 584, 40, 307, 840], [569, 295, 347, 740, 838], [758, 517, 224, 981, 158, 388, 376, 446], [203, 111, 567, 533, 984, 862, 265, 256], [195, 361, 411, 897, 513, 289], [623, 690, 233, 855], [267, 125, 260, 266, 567, 868], [410, 488, 865, 192], [235, 238, 185, 206, 98], [551, 599, 126, 919, 409, 440, 574], [771, 601, 250], [134, 315, 969, 397, 674, 611], [834, 510, 898, 920, 579, 8, 406, 59], [163, 130, 842, 291, 749, 619, 733, 518, 970], [112, 509, 34, 468, 514, 313, 189, 730, 349, 145], [787, 486, 963, 779, 807, 649, 729, 505], [945, 23, 9, 766, 51, 330], [385, 176, 663, 594, 513, 494, 449], [238, 356, 88, 961, 953, 206], [77, 353, 409, 574], [820, 870, 478], [452, 328, 706, 992, 455, 246], [827, 121, 270, 469, 652, 540, 69], [321, 603, 841], [643, 24, 703, 502, 225, 909, 876], [564, 831, 634, 223, 871], [608, 946, 550, 377, 223, 965, 705], [970, 733, 891, 39, 619, 986], [915, 598, 72, 429], [952, 606, 955, 950, 566, 830, 311], [808, 258, 37, 686, 840], [532, 203, 83, 712, 567, 867], [633, 968, 34, 94, 509], [374, 954, 572, 208, 331, 611, 397, 172], [187, 406, 896, 938], [345, 47, 885, 699, 536, 144, 726, 534, 464, 997, 835], [454, 154, 220, 328, 872, 19, 452], [620, 760, 283], [972, 666, 33, 394, 344, 949, 139, 288, 215], [464, 384, 480, 726, 864, 304], [341, 512, 679, 216, 817, 580, 813, 343, 672], [748, 442, 827, 300, 102, 887, 469], [530, 319, 474, 938, 445], [824, 200, 911, 926, 723, 760, 620, 562, 256, 347], [358, 157, 259, 389, 224, 26], [29, 86, 260, 467, 266, 828], [599, 551, 89, 440, 71], [272, 997, 184, 271, 172], [370, 335, 639, 904, 167], [664, 793, 902, 836], [842, 93, 543, 619, 940], [698, 979, 910, 934], [812, 799, 217, 588, 814], [2, 219, 942, 994, 280, 529, 615, 704, 472], [315, 91, 631, 820, 674], [65, 165, 289, 428, 418, 176, 422], [645, 937, 281, 803], [302, 621, 482, 411, 450], [971, 373, 54, 506, 1, 823], [275, 877, 394, 215, 118], [900, 204, 493, 751, 416, 327, 221], [908, 333, 197, 508, 738, 470], [747, 850, 310, 765, 497, 549, 182], [26, 735, 259, 157], [536, 156, 25, 534, 660, 115], [166, 313, 740, 94, 77, 349, 409, 729], [677, 152, 501, 468, 189], [671, 670, 456], [947, 151, 18, 414, 21, 242, 255, 759, 451, 528], [257, 244, 530, 350, 32], [777, 337, 695, 45, 445, 802, 790], [414, 947, 148, 255, 226], [677, 501, 44, 241, 146], [577, 916, 531, 909], [635, 220, 68, 116, 470, 454], [924, 233, 623], [339, 553, 895, 699, 25, 536, 144], [259, 26, 143, 124], [402, 82, 472, 446, 376, 704], [625, 589, 881, 392], [401, 198, 336, 762], [376, 517, 753, 525], [179, 405, 594, 537, 840], [749, 291, 93], [724, 622, 879, 935, 359], [869, 860, 648, 308, 866, 65, 422, 135], [313, 354, 145, 740], [173, 640, 288, 839, 639, 128, 335], [995, 497, 742, 985, 818, 747, 850], [856, 396, 965], [171, 654, 581, 714, 264, 737], [170, 714, 246, 992, 264, 207], [604, 795, 453, 271, 127, 738, 997, 507, 835, 572, 113], [74, 640, 167, 639], [213, 293, 559], [773, 310, 765, 736], [603, 385, 321, 97, 663, 289, 418, 135], [478, 702, 870, 890, 466, 644, 329, 888], [471, 678, 180, 285], [162, 449, 14, 537, 594, 36], [285, 178, 678, 548, 878, 219], [682, 683, 436, 262], [325, 521, 372, 936, 549, 721, 142, 850, 28, 626], [516, 17, 775, 815], [412, 456, 284, 272, 819, 271, 127, 997], [535, 715, 627, 206, 642, 235, 88], [853, 852, 574, 681, 440, 353, 69], [114, 406, 201, 896, 695, 880, 802, 932], [338, 53, 847, 418, 307], [146, 730, 677, 468, 94], [791, 750, 312, 390, 743, 756, 587], [882, 762, 42, 306, 881, 360], [422, 732, 648, 87, 488, 865], [697, 40, 584, 6, 941, 248], [363, 254, 964, 472, 615], [361, 84, 423, 513, 293, 593, 213], [901, 241, 968, 633, 44], [519, 675, 333, 141, 470, 404], [433, 401, 160, 762, 389], [939, 539, 703, 225], [526, 602, 379, 303, 723, 396, 911, 123], [406, 399, 880, 58, 187], [628, 500, 428, 317, 298, 858], [83, 111, 532, 862], [352, 309, 493, 140, 287, 416], [556, 247, 387, 557, 218], [889, 535, 185, 884, 88, 969, 98, 953], [264, 431, 756, 171, 992, 739, 918, 462], [932, 374, 268, 477, 790, 113, 331], [5, 437, 286, 859, 391, 544, 652, 818], [617, 403, 320, 415, 810], [653, 67, 837, 957, 925, 865, 18], [956, 48, 343, 50, 455, 246], [174, 293, 559, 61, 494, 195, 423, 472, 402], [728, 263, 944, 684, 986], [139, 275, 118, 949, 236, 441, 764, 70, 421, 950], [413, 817, 380, 512, 120], [883, 812, 132, 592, 673, 746, 814, 665], [205, 397, 247, 557], [2, 878, 133, 180, 942, 548], [872, 154, 116, 967, 470, 508, 403], [416, 257, 554, 751, 474, 334, 140], [846, 792, 665, 796, 805], [634, 831, 105, 946, 973, 106, 683, 705, 4, 826], [124, 358, 259, 758, 981, 517, 82], [806, 939, 253, 199, 703, 502, 104], [763, 578, 414, 151, 255], [710, 481, 688, 884, 395, 314, 969], [985, 962, 781, 927, 277], [444, 400, 61, 559], [718, 659, 430, 392, 589, 978, 420], [498, 232, 245, 892, 503, 848, 780], [503, 231, 966, 892], [855, 155, 924, 85, 623, 897, 65, 289], [522, 405, 307, 80], [88, 715, 185, 238, 314, 557], [43, 275, 764, 215, 707, 427, 690, 578], [721, 49, 914, 372], [98, 88, 235, 961, 557, 420], [809, 15, 27, 718, 659, 669, 644], [309, 493, 327, 438, 542, 319, 832, 976], [468, 196, 34, 968, 44, 501, 152], [957, 925, 21, 148, 414], [676, 590, 344, 972, 1], [257, 149, 474, 530], [231, 498, 780, 861, 906], [714, 171, 212, 455, 343, 101, 992], [387, 205, 570, 218, 969, 397], [674, 6, 888, 193, 584, 689], [934, 979, 23, 51, 38, 9], [506, 971, 279, 90, 601, 74, 771, 657, 639], [64, 700, 675, 635, 68, 519], [807, 757, 845, 490], [711, 806, 381, 225, 502, 922], [964, 194, 363, 857, 529, 495, 301], [151, 226, 578, 523, 764, 947, 148, 451], [83, 862, 265, 951, 347, 355, 562, 123], [149, 244, 350, 474, 221, 416], [808, 776, 110, 686], [157, 143, 735, 124, 224, 768, 517], [29, 125, 86, 868, 467, 984], [476, 305, 56, 22], [614, 436, 921, 181, 683, 708], [728, 214, 684, 944, 39, 294, 891], [207, 431, 170, 171, 737], [451, 984, 759, 83, 951, 256], [568, 828, 267, 86, 125], [86, 867, 568, 266, 567], [696, 541, 572, 954, 374, 208, 477], [650, 563, 875, 282], [833, 290, 827, 744, 540, 102], [819, 453, 172, 184, 127], [127, 997, 184], [772, 50, 31, 580, 455, 582, 974], [479, 775, 835, 647], [877, 54, 139, 215, 971, 43, 236], [499, 921, 57, 614], [736, 781, 504, 310, 228, 927, 643], [571, 843, 720, 318, 56], [1, 506, 250, 640, 74, 676], [511, 878, 471, 2, 529, 133], [136, 803, 645, 284, 725, 795, 794], [875, 269, 650, 585, 975, 915, 408, 485, 17], [548, 994, 117, 620, 704, 760, 861, 873], [803, 937, 725, 281, 819, 894, 382, 456, 184], [180, 178, 548, 471, 511], [859, 209, 544], [63, 407, 352, 32, 416, 350, 204], [839, 344, 167, 118, 949, 335, 734, 843], [663, 84, 176, 513, 897, 135, 65, 233], [540, 270, 744], [524, 163, 749, 842, 543, 93], [927, 600, 929, 539, 703], [369, 559, 174, 213, 593, 195], [605, 944, 263, 891], [586, 347, 862, 81, 838], [755, 7, 815, 349, 304, 730, 864, 849], [638, 848, 503, 716], [854, 72, 317, 858, 202], [26, 735, 980, 306, 978, 420, 389, 762], [41, 442, 887, 731, 121], [495, 906, 529, 254, 511], [137, 621, 482, 20], [492, 538, 602, 987, 515, 200, 396], [727, 726, 25, 119, 864, 296, 835, 7], [782, 716, 761, 261, 476, 562, 22, 861], [882, 191, 299, 762, 589, 978], [234, 522, 405, 418, 321, 80, 917, 188, 847], [860, 866, 165, 648, 65, 855], [352, 204, 493, 438, 240], [175, 765, 736, 277, 504, 142, 549], [661, 30, 830, 109, 950, 523], [750, 190, 431, 737, 756], [514, 354, 94, 166, 145], [642, 481, 395, 227, 715, 46, 235, 557], [134, 91, 631, 466, 969, 719], [719, 430, 667], [298, 598, 72, 202, 500, 898, 832], [495, 278, 593, 450, 571, 56, 906], [368, 632, 32, 438, 122, 530, 240, 976, 445, 0], [967, 403, 332, 210, 810], [103, 603, 841, 594, 176, 405, 307, 418], [330, 489, 366, 51, 993], [383, 930, 871, 693, 958, 910, 636, 38, 605, 52], [616, 922, 565, 711, 502], [182, 521, 372], [687, 487, 680, 899, 575, 880, 331], [900, 12, 542, 493, 140, 751, 240], [19, 706, 101, 116, 452], [644, 419, 669, 928, 177, 888], [766, 945, 489, 322, 96, 9, 525, 51], [899, 326, 58, 880, 717, 461, 932, 458, 208, 113, 611], [967, 872, 19, 320, 810, 655], [380, 908, 141, 197, 745, 413, 404], [778, 751, 709, 988, 554, 221], [370, 128, 167, 288, 427, 843, 571, 459], [160, 401, 762, 388, 851], [777, 150, 695, 445, 896], [188, 53, 847, 546], [156, 553, 25], [588, 948, 786, 916], [120, 512, 679], [691, 699, 47], [48, 212, 580, 246, 714, 923, 737, 120, 672, 475, 933], [839, 676, 288, 243, 972, 118], [47, 691, 885, 115], [881, 625, 589, 882], [295, 586, 81, 569, 862, 256, 123], [496, 837, 785, 838, 408, 740, 354, 730], [296, 849, 729, 94, 730, 145], [416, 32, 287, 257, 149], [989, 443, 597, 56, 476, 562], [204, 309, 287, 63, 438], [99, 574, 77, 186, 569, 69], [514, 313, 509, 44, 166, 677, 730, 740, 348], [30, 830, 951, 597, 562, 256], [98, 961, 953, 668], [955, 606, 566, 734], [389, 124, 981, 224], [980, 768, 420, 879, 164, 935], [851, 35, 762, 36, 191, 42, 449], [411, 482, 195, 84, 20, 593], [722, 465, 931, 784, 859, 457, 71, 990, 440], [194, 254, 472, 857, 61], [78, 611, 576, 378], [682, 960, 683, 991, 591], [322, 489, 993, 375, 525, 16, 873, 376, 704], [46, 395, 630], [632, 319, 407, 32], [293, 559, 400, 593], [128, 335, 904, 427], [618, 622, 724, 935, 753, 9], [914, 936, 325, 182, 237, 521, 49, 801, 786], [54, 877, 823, 394, 138], [954, 113, 268, 208], [993, 473, 741, 366, 873, 977], [161, 517, 525, 366, 82, 704, 158], [608, 560, 106, 856, 965, 636], [364, 552, 417, 576, 611, 55], [484, 555, 76, 602, 526, 200, 723], [413, 333, 745, 216, 817], [922, 800, 253, 806, 616, 3, 746, 804], [798, 60, 547, 692, 894, 671, 456, 284], [323, 930, 612, 871], [480, 626, 119, 864], [603, 841, 594, 176, 97], [933, 28, 390, 737], [247, 629, 558, 556, 570, 205], [336, 401, 433, 851, 981, 35, 426, 446, 82], [358, 981, 124, 433, 198, 26, 299, 762], [791, 743, 190, 750, 996, 386, 737, 28], [62, 903, 931, 437, 209, 652], [821, 159, 881, 589, 419, 669, 659, 230], [613, 424, 960], [823, 877, 373, 666, 139, 118], [367, 46, 630, 558, 314, 227, 688], [169, 856, 965, 705, 987, 303, 911, 200], [218, 247, 969, 91, 611, 113], [80, 917, 584], [680, 575, 687, 880, 58, 201], [229, 61, 857, 559, 369, 495, 593], [160, 433, 198, 336, 388], [158, 472, 494, 213, 446], [320, 210, 617, 967, 220, 508], [844, 519, 64, 512, 197, 582, 413, 333], [522, 234, 307, 162, 594, 321, 80, 840], [201, 187, 114, 58, 59, 938, 920, 92], [63, 632, 287, 368, 32], [975, 785, 282, 348, 17, 730], [713, 505, 919, 99, 89, 729, 77, 574, 145], [434, 87, 435, 488, 662, 865], [482, 361, 137, 84, 450, 459, 897], [184, 456, 670, 671, 996, 28, 997, 464], [380, 216, 333, 404, 512], [151, 226, 763, 148, 242, 957, 732], [918, 810, 463, 210, 617, 11, 460], [350, 287, 221, 204, 257, 140], [378, 552, 579, 55, 8, 917, 701, 847], [188, 53, 307, 176, 428, 321, 135], [669, 329, 928, 821, 392], [978, 359, 980, 299, 935, 230, 430, 961, 238, 52, 557], [70, 764, 523, 950, 215], [192, 648, 165, 858, 488, 135, 428], [513, 195, 494, 213], [393, 613, 436, 57, 614, 960], [686, 14, 36], [446, 35, 388], [771, 707, 657, 904, 370, 335, 236, 623, 690, 924, 459], [546, 53, 847, 418, 202, 628, 135, 858, 422], [72, 769, 858, 108, 915, 651, 488, 975], [668, 961, 953, 719, 316, 667, 718, 230, 420], [756, 264, 312, 207, 737], [720, 56, 443], [198, 401, 388, 981, 389], [435, 410, 829, 662], [434, 829, 410, 483, 865, 907], [614, 262, 424, 682, 181, 960], [784, 5, 209, 903, 465, 391], [632, 63, 352, 309, 319, 240], [611, 55, 458], [681, 752, 990, 186, 362, 71, 126, 89, 574], [734, 949, 215, 950], [41, 300, 748, 121], [989, 351, 597, 432, 56, 720], [229, 61, 559], [896, 337, 150, 938, 122, 319, 790, 0, 789], [426, 35, 449, 388, 82, 402, 158, 494], [744, 66, 827, 833], [863, 658, 982, 466], [179, 35, 446, 360, 594, 36, 494, 97], [621, 137, 459, 593, 411, 318, 571], [759, 265, 255, 523, 148, 951], [101, 454, 328, 116, 974, 455], [271, 819, 604, 795, 172, 725], [116, 452, 635, 974, 154], [956, 50, 974, 273, 212, 452, 101, 246], [670, 412, 184, 147, 671, 382, 284], [652, 469, 731, 931, 362, 990], [55, 461, 8, 439, 611, 331], [450, 411, 897, 924, 335, 571, 427], [11, 573, 794, 739, 415, 617], [717, 59, 458, 8, 331], [547, 692, 596, 739, 207, 756], [573, 739, 11, 415, 918], [119, 726, 412, 997, 480, 115, 28], [903, 722, 362, 437, 784], [890, 448, 982, 863, 27, 177, 820, 631, 644, 667, 315, 719], [29, 125, 260, 828, 984, 528, 759], [241, 34, 501, 94, 146, 189], [887, 731, 457, 652, 121, 102], [68, 675, 154, 197, 220, 508, 141], [178, 678, 878, 285, 280, 511], [615, 194, 363, 61, 402, 133, 158, 213, 704], [993, 741, 375, 979, 51], [244, 257, 221, 554, 530, 122, 938, 920], [672, 813, 343, 933, 49, 721], [261, 56, 305, 351, 562], [572, 268, 208, 790, 789, 647, 835], [177, 702, 870, 100, 820, 888, 674], [274, 775, 7, 835], [626, 384, 119, 464, 28], [710, 884, 314, 227, 627, 642], [302, 411, 137, 361, 20], [651, 907, 829, 435], [555, 379, 515, 983, 76], [976, 624, 585, 282, 0, 17, 516], [779, 649, 95], [326, 899, 680, 58], [87, 410, 662, 651, 192, 422, 429, 858], [330, 322, 525, 366], [252, 757, 656, 807, 849, 919], [662, 829, 651], [303, 538, 987], [900, 309, 204, 140, 327, 240], [423, 513, 213, 402, 97, 449, 446], [301, 857, 318, 400, 254, 906, 593], [67, 653, 348, 527, 837, 865, 785], [765, 773, 995, 962, 985, 168, 142, 747], [892, 231, 245, 906], [276, 921, 57, 693, 708], [628, 202, 701, 317, 898], [468, 152, 241, 146], [711, 253, 324, 225, 104, 565, 909, 799], [966, 232, 297, 231, 848, 638], [876, 277, 531, 643, 577, 310, 549], [649, 779, 95, 713, 729, 409], [1, 279, 250, 971, 138], [816, 801, 811, 664, 738, 814, 665, 172], [141, 470, 220, 738, 403, 617], [94, 514, 112, 633, 354, 44], [920, 834, 92, 898], [280, 471, 285, 548, 529, 906, 861, 301], [404, 341, 583, 582, 679, 413, 216, 120], [423, 195, 494, 84, 663, 97, 289], [313, 509, 354, 94], [555, 484, 602, 983, 940, 538, 303], [183, 561, 17, 647, 0, 775, 485], [758, 161, 224, 82, 376, 753, 259, 768], [685, 783, 749, 524, 93, 970], [844, 197, 404, 675, 64, 251], [941, 37, 36, 697, 840], [325, 182, 549, 372, 916, 786], [405, 234, 307], [421, 764, 950, 311, 255, 661, 451, 951], [291, 543, 749, 983, 518, 685], [9, 489, 330, 366, 161, 376, 753], [200, 602, 379], [907, 785, 651, 865, 975, 496], [828, 467, 759, 862, 148, 838, 18, 837], [280, 615, 964, 511, 254, 133, 301], [122, 149, 32, 244, 319, 474], [876, 909, 577, 153, 504], [712, 111, 203, 568, 828, 862], [984, 868, 567, 83], [660, 913, 144, 835, 115], [185, 627, 889, 206], [156, 144, 699, 115], [840, 808, 776, 14, 179, 162], [987, 492, 940, 619, 303, 515, 986], [199, 939, 929, 73, 754, 703, 292], [290, 270, 744, 788, 102, 69, 990], [696, 572, 268], [12, 327, 988, 767, 240, 832], [524, 842, 291, 130, 983, 940], [859, 286, 742, 71, 209, 818], [667, 905, 863], [53, 847, 338, 428], [692, 462, 596, 382, 894], [285, 180, 219, 942, 511, 994, 283, 861], [916, 521, 577, 182, 504, 310, 142], [560, 608, 106, 946, 610, 958], [89, 599, 126], [378, 417, 917, 576, 584], [339, 895, 156, 825, 25], [778, 334, 221, 767, 474, 920], [484, 379, 515, 602], [557, 205, 387, 629], [556, 629, 205, 46, 218, 314, 235, 238, 420, 52], [570, 629, 630, 688, 387, 395], [369, 293, 444, 229, 61, 400, 174, 213], [550, 608, 377, 958, 636], [647, 789, 516, 0], [782, 305, 476, 351, 597, 355, 620, 256, 123], [650, 585, 269, 624, 875], [831, 958, 105, 871], [812, 799, 324, 616, 592, 502], [952, 955, 357, 109, 734, 830], [867, 267, 868, 111, 86, 83, 533], [266, 867, 712, 267, 828, 532], [81, 347, 740, 77, 353, 69], [688, 558, 387, 969, 247], [843, 278, 335, 318, 450, 459], [541, 696, 268, 954, 113, 477, 835, 172], [463, 11, 739, 460], [353, 186, 99, 440, 89, 409], [880, 399, 687, 326], [689, 78, 364, 378, 552, 584], [153, 916, 531, 549, 504], [763, 226, 255, 690, 764, 236], [8, 92, 417, 701, 898], [31, 50, 273, 48, 343, 679, 120], [654, 923, 714, 170], [700, 583, 64, 772, 974, 273, 404, 512], [10, 797, 772, 582, 679, 512], [40, 193, 398, 80, 917, 248, 552, 689, 576], [624, 650, 563, 485, 282], [295, 347, 862], [743, 756, 190, 692, 996, 60], [340, 948, 799, 132, 814, 909, 916], [159, 625, 346, 392, 882, 306, 978, 230], [33, 243, 972, 666, 823, 1], [612, 991, 365, 960], [883, 673, 217, 812, 616, 565], [20, 621, 450, 361, 318, 369, 400, 293, 195, 495], [841, 321, 385, 97, 405, 162, 179, 449], [893, 959, 963, 787, 807], [894, 547, 462, 739, 937, 794, 645], [351, 989, 443, 720, 830, 734, 562, 843, 355], [108, 915, 317, 72, 875, 624, 832], [551, 126, 89, 919, 71, 850], [929, 292, 927, 694, 637, 818, 985], [90, 771, 971, 250, 43, 707], [515, 555, 526, 379, 303, 200], [103, 385, 321, 841, 176], [172, 795, 453], [294, 891, 944, 52, 970, 636, 323], [357, 109, 955, 950, 734], [802, 790, 932], [377, 550, 106, 560], [822, 693, 708, 910], [958, 831, 550, 946], [439, 364, 55, 78, 378, 458, 689, 674, 331, 113, 91, 397], [591, 991, 973, 960, 871, 383, 930, 613], [393, 424, 960, 57, 930, 612, 693], [436, 262, 424, 276, 921, 57], [472, 964, 194, 529, 133], [324, 922, 673, 381, 592, 565, 746], [210, 403, 415, 460, 508, 794, 738], [371, 724, 879, 753], [940, 130, 93, 733, 538, 107, 986], [117, 760, 283, 861, 782, 562, 123], [302, 137, 20, 450, 593], [724, 164, 371, 935], [85, 690, 233, 155, 924, 427], [585, 563, 875, 485, 976, 832, 598], [159, 589, 346, 881], [480, 384, 864, 28, 182, 849, 850], [889, 535, 185, 884, 481, 642], [500, 202, 701, 428, 847], [630, 558, 46, 387, 557, 556], [46, 629, 367, 558, 395], [820, 315, 134, 466], [368, 407, 63, 438, 319], [901, 968, 112, 196, 44, 509], [871, 105, 223, 973], [68, 154, 251, 454, 700, 974], [560, 377, 944, 856, 958, 987, 605, 323], [694, 805, 754, 929, 770, 600], [297, 503, 966, 716, 22], [657, 173, 74, 904, 167, 128, 250], [74, 173, 167, 279, 676, 839], [3, 73, 796, 754], [314, 715, 481, 185, 627], [104, 24, 703, 876, 504, 927, 277], [329, 27, 239, 669, 466, 177], [136, 937, 281, 794, 596], [982, 27, 658, 15], [561, 789, 516, 775, 274, 477, 835], [869, 860, 165, 308, 422, 732, 855, 192], [779, 486, 95, 505], [563, 585, 269, 282], [491, 662, 829, 483, 488, 907, 527, 429, 975], [457, 469, 102, 931, 391, 69, 209], [211, 67, 496, 837], [923, 581, 170, 737], [810, 918, 19, 332, 706, 992], [729, 490, 849, 807], [904, 639, 771, 427, 250], [15, 646, 982, 448, 809, 863, 905], [230, 718, 669, 239, 392], [913, 534, 144, 835, 25], [30, 311, 523, 951], [829, 491, 434, 651, 410, 488], [289, 97, 513, 176], [793, 129, 902, 811, 738, 507], [792, 222, 804, 746, 805, 217, 814, 770, 507], [33, 118, 394, 590, 823], [545, 905, 316, 863, 719, 718, 430, 466], [430, 961, 356, 953], [659, 239, 419, 644, 329, 392], [456, 147, 412, 671], [147, 670, 456, 412, 798, 382, 60, 996], [475, 813, 120, 343], [592, 746, 616, 217], [248, 888, 689, 478, 611, 820, 134, 91], [68, 470, 197, 251, 519], [243, 344, 839, 640, 279, 1], [152, 146, 44, 189, 354, 730], [471, 178, 878, 180], [10, 797, 583, 31, 341, 580, 512, 120], [687, 399, 326, 58, 487], [440, 752, 990, 852, 186], [181, 683, 365, 436, 960], [181, 682, 365, 262, 991, 973, 708, 223, 75, 826], [728, 263, 39, 214, 986], [783, 76, 518, 524, 983], [425, 258, 14, 776, 110, 37, 36], [326, 680, 399, 575], [570, 227, 558, 969, 395], [576, 674, 78, 248, 584, 611], [623, 85, 855, 578, 763, 236, 427, 732], [342, 885, 47, 345, 699, 825], [547, 462, 587, 382, 756, 60], [822, 499, 609, 708, 57, 613, 930, 910, 323], [770, 637, 818, 600], [777, 150, 337, 45, 802, 896, 187], [541, 268, 572, 954], [193, 40, 941, 520, 840], [131, 979, 910, 75, 741], [895, 342, 825, 691, 47, 156, 536, 115], [582, 64, 251, 974, 635], [500, 628, 579, 847, 898, 417], [870, 478, 177], [24, 199, 643, 104, 539, 225, 292, 927], [994, 133, 16, 873, 283, 366, 472, 376, 158], [4, 911, 965, 396, 106, 223], [328, 992, 101, 19, 655], [771, 601, 427, 43, 236], [499, 921, 609, 693, 262, 683, 910, 75], [751, 12, 334, 988], [481, 884, 227], [253, 502, 324, 922], [532, 867, 568, 111], [409, 505, 919, 779, 963], [581, 246, 170, 171, 923, 343], [185, 642, 235, 314], [761, 912, 297, 848, 638, 305, 22], [59, 461, 58, 331], [230, 659, 239, 809, 905, 667, 430], [316, 430, 953, 667, 969, 315, 466], [432, 56, 278, 443, 843, 597], [914, 936, 237, 49, 182, 475, 933, 28], [62, 465, 903, 931, 362], [200, 379, 76, 52, 123], [622, 164, 371, 879, 618], [819, 284, 453, 281, 795], [727, 885, 304, 115, 464, 119], [726, 304, 885, 25], [263, 214, 684], [656, 849, 807, 95, 505, 349, 409, 145], [189, 677, 94, 354, 815, 349, 296, 17, 408, 348], [887, 41, 300, 469, 457, 788, 990], [192, 648, 855, 690, 763, 414, 957, 865], [970, 93, 107, 619], [441, 357, 566, 606, 949, 950, 288, 830, 597, 843], [143, 26, 259, 980, 768, 299], [175, 310, 781, 773, 962, 277], [923, 654, 170, 312, 431, 264, 750, 343, 390, 386, 933], [908, 745, 141, 508, 817, 617, 902, 794, 664, 795, 172, 507], [573, 463, 460, 918, 794, 462, 207, 596], [145, 166, 81, 354, 77, 569, 838, 348], [473, 13, 75, 979, 698, 375, 977], [168, 544, 818, 850, 71], [390, 190, 996, 587], [447, 788, 66, 833, 270, 290, 540], [908, 380, 333, 738, 817], [673, 804, 616, 381, 217, 665], [850, 142, 497, 168], [121, 442, 66, 827, 41, 788], [163, 291, 524, 93, 518], [312, 190, 791, 390, 737], [709, 334, 140, 12, 221, 327], [440, 681, 990], [618, 161, 371, 879, 525, 9, 517, 768], [73, 641, 805, 796, 929, 539, 637], [7, 815, 296], [431, 190, 587, 312, 207, 692, 462], [845, 252, 959, 490, 963, 919], [82, 517, 224], [467, 451, 984, 265, 528, 148], [117, 620, 886, 79, 926, 283, 873, 123], [912, 716, 874, 861, 305], [160, 336, 198, 851, 191, 360, 306, 389, 299], [226, 578, 414, 690, 732], [70, 421, 236, 215, 523, 255, 578], [773, 175, 497, 310, 142], [330, 945, 96], [778, 988, 554, 542, 832, 920], [980, 359, 735, 259, 879, 753, 517], [72, 854, 429, 858], [818, 694, 637, 805, 665], [90, 707, 601, 427, 250, 657], [797, 273, 583, 31, 582], [175, 765, 497, 736, 962], [861, 943, 780], [183, 479, 516, 274, 647, 7, 815], [14, 258, 808, 686, 537], [695, 150, 337], [334, 767, 988, 554], [649, 486, 95, 963, 505, 713], [848, 943, 912, 874, 774, 231, 245, 861], [962, 736, 228, 277], [562, 305, 861, 620], [685, 76, 518, 970], [437, 5, 465, 362, 859], [408, 527, 975, 496, 348], [948, 340, 814, 916, 521, 801, 372], [595, 963, 95, 807], [744, 66, 748, 41, 540, 731, 990], [0, 561, 647, 445, 790, 477], [607, 802, 150, 932, 445, 208, 477, 789], [190, 750, 390], [846, 665, 222, 804], [664, 129, 836, 811, 813], [460, 739, 645, 617, 596, 281, 738, 795], [604, 172, 453, 725, 281, 794, 738], [222, 846, 641, 3, 754, 805], [10, 772, 583, 679, 31], [382, 60, 671], [812, 132, 565, 588, 502, 909], [3, 381, 806, 73, 939], [816, 507, 811, 372, 49, 786, 814], [607, 45, 695, 150, 790, 932, 187], [284, 937, 281, 136], [792, 746, 846, 665, 3, 381], [637, 754, 796, 222, 665, 770], [225, 253, 381, 939, 800], [252, 845, 959, 595, 490, 787, 656, 95, 729], [258, 110, 776, 840, 537], [239, 15, 658, 718, 905], [918, 655, 332, 320, 415, 210], [793, 664, 507, 816, 813, 49, 801], [799, 883, 132, 217, 565, 592], [836, 120, 902, 817, 672, 475, 793, 811, 49], [948, 132, 588, 217, 786, 665, 801, 507], [755, 7, 296, 775, 183, 730, 17], [507, 801, 811], [216, 380, 745, 120, 738, 902, 813], [770, 694, 600, 985, 168, 742, 544, 209], [271, 453, 725, 284, 184], [100, 631, 870, 478, 890, 466, 134, 674], [392, 881, 42, 419, 941, 928], [609, 693, 910], [394, 373, 666, 590, 1, 138], [911, 4, 926, 123], [895, 553, 699, 691, 25, 885], [977, 79, 75, 683, 223, 4], [66, 447, 121, 748, 833, 270, 102], [266, 568, 125, 467, 532, 528, 862], [662, 491, 435, 434, 651, 483], [311, 30, 566, 109, 355, 734, 597], [564, 958, 610, 105, 946, 223], [542, 240, 767, 976, 920, 624, 898, 598, 317], [270, 447, 827, 744], [92, 510, 898], [913, 660, 534, 25, 115, 479, 274, 304, 997, 7, 172, 647, 477, 572], [902, 129, 813, 793], [838, 653, 211, 496, 18, 348, 528], [837, 528, 862, 348, 295, 81, 740], [288, 344, 676, 640, 167], [537, 808, 110, 37, 520, 162, 697, 40, 405, 80], [594, 103, 603, 321, 385], [130, 543, 291, 93], [571, 278, 720, 335, 288, 734, 597], [519, 404, 64], [757, 959, 252, 807], [792, 222, 804, 796, 3], [546, 338, 188, 428, 701, 628, 307, 417, 917], [780, 297, 503, 912, 231, 716], [729, 656, 490, 349, 919, 864, 296, 626, 850], [747, 142, 168, 742, 182, 599, 71, 626, 919, 849], [360, 336, 762, 35, 388], [853, 186, 681, 990, 69], [852, 186, 69], [298, 769, 72, 858], [233, 85, 690, 308, 648, 65, 732], [169, 396, 965, 377, 987, 636], [400, 61, 363, 254, 495], [429, 769, 854, 298, 422, 488, 202, 428], [286, 209, 5, 784, 71, 362, 544], [869, 308, 165, 648], [774, 943, 874, 780, 245, 761, 305, 906, 511, 782, 548, 283, 620], [532, 203, 83, 828, 528, 256, 586, 295, 838, 347], [448, 658, 905, 545, 466, 667], [626, 384, 119, 304, 849, 296], [435, 410, 87, 907, 527, 67, 211, 496, 957, 192, 732], [308, 65, 165], [267, 567, 712, 568, 111], [533, 984, 567, 260, 86], [648, 860, 165], [702, 478, 177, 890, 100, 820], [634, 973, 612, 105, 383, 323, 564, 958], [220, 967, 332, 116, 19], [16, 375, 366, 977, 704, 79, 283, 760], [943, 912, 761, 780, 861], [269, 282, 563, 915, 624, 598], [531, 504, 909, 104, 643], [54, 373, 394, 275, 139], [678, 471, 280, 180, 219, 2], [164, 724, 618, 753, 768, 359], [575, 399, 326, 201, 331, 187, 932], [346, 625, 159, 882, 392, 191, 821, 42], [306, 191, 881, 346, 589], [592, 217, 812], [710, 889, 481, 627, 227, 206, 969], [691, 345, 115, 825, 25, 726, 727], [926, 79, 760], [469, 300, 731, 121], [928, 6, 674, 248, 329, 177, 478], [627, 884, 535, 206], [870, 177, 466, 820], [39, 107, 294, 263, 605, 970], [498, 232, 231, 966, 22, 906], [595, 963, 959], [596, 547, 382, 937, 284], [825, 553, 699, 156], [445, 938, 337, 695, 114, 187], [84, 924, 411, 459, 233, 289], [834, 92, 510, 920, 579, 701, 500, 317, 832], [331, 487, 326, 58], [327, 493, 140], [633, 968, 196], [836, 129, 664, 817, 813, 738], [62, 465, 722, 391, 437], [657, 639, 128, 370, 427], [809, 658, 718, 863, 545, 667], [892, 301, 22, 498, 245, 861, 495, 511, 318, 56], [483, 527, 651, 435, 865], [745, 141, 333, 738], [531, 876, 502, 104, 153, 916, 799, 588], [609, 822, 131, 698, 693, 708, 75, 934, 38, 323], [4, 824, 705, 396, 200, 123], [761, 874, 716, 780, 848], [660, 534, 835], [936, 372, 721, 237], [108, 598, 875, 429, 282, 975], [153, 577, 549, 909, 588, 340, 521, 786], [398, 80, 552, 584, 307, 417, 847], [810, 655, 415, 992, 463, 739, 207], [713, 89, 599, 409, 963, 757, 490, 849, 850], [510, 767, 554, 474, 92, 898, 406, 832, 938], [276, 499, 614, 262, 708], [324, 616, 381, 253, 711], [654, 581, 737, 714, 343], [155, 233, 623, 897, 459, 427], [957, 242, 21, 18, 211], [886, 824, 79, 4, 760, 123], [292, 600, 228, 703, 985, 643, 277], [888, 6, 329, 419, 941, 821], [539, 754, 600, 292, 637], [383, 323, 613, 612, 693], [722, 62, 362, 391, 457, 652], [208, 607, 802, 790, 880, 187, 331], [28, 386, 737, 343, 475, 721], [131, 979, 38, 249, 910], [622, 164, 371, 359, 9, 420, 38, 52], [914, 372, 721, 182], [803, 136, 645, 284, 894, 596], [896, 445, 122, 474, 114, 406, 920], [199, 225, 539, 806, 73, 800], [619, 130, 543, 983, 538, 515], [520, 6, 193, 697, 36, 42, 928, 821], [994, 219, 548, 133], [774, 874, 861, 780], [214, 263, 294, 986, 605, 636, 987], [9, 766, 96, 330], [106, 550, 831, 610, 223], [148, 151, 255], [340, 814, 588, 786], [118, 441, 288, 734, 215], [606, 109, 734, 441, 421, 215, 311, 523], [30, 661, 355, 265, 451, 523, 256], [955, 109, 566], [356, 668, 98, 430, 206, 969, 719], [696, 268, 374, 572, 113], [952, 357, 566, 606, 109], [50, 212, 455], [925, 242, 414, 211, 865, 732], [610, 564, 831, 550, 560, 871, 636, 323], [845, 893, 595, 757, 807, 963], [393, 613, 424, 365, 436, 682, 591, 612], [356, 668, 98, 430, 238, 420], [781, 228, 736, 985, 773, 497], [893, 595, 959, 787, 757, 95, 779, 713, 919], [254, 194, 615, 529], [169, 856, 396, 377, 106, 705], [503, 232, 892, 638, 22], [332, 872, 320, 220, 403], [34, 901, 633, 196, 112, 241], [688, 227, 570, 884, 206, 247, 953, 397, 719, 91, 315], [733, 107, 93, 518, 783, 891, 76, 605, 52], [138, 506, 250, 601, 54, 43, 275], [118, 33, 590, 243, 344], [612, 991, 871, 634, 683, 223], [700, 454, 582, 455, 452, 635, 273], [408, 785, 282, 527, 915, 651, 429], [485, 240, 319, 624, 832, 0], [826, 13, 75, 79, 741, 375, 873], [420, 299, 306, 589, 230], [698, 131, 934, 249, 473, 741, 51], [768, 359, 735, 299, 420], [389, 358, 433, 224, 388, 82], [646, 27, 658, 448, 466], [543, 524, 940, 685, 515, 76, 484], [533, 868, 260, 83, 467, 759, 265], [228, 962, 927, 497, 995, 600, 818, 168], [684, 39, 214, 944, 987, 538, 107, 619], [538, 492, 303, 986, 856, 396, 944, 636], [767, 778, 334, 709, 12, 542], [351, 443, 597], [752, 440, 681, 731, 788, 457, 362, 540, 852, 69], [591, 612, 365, 973, 683], [706, 101, 655, 171, 246, 918, 207], [473, 375, 51, 322, 366], [942, 133, 548, 704, 283], [497, 985, 168], [60, 743, 390, 587, 671, 28, 412], [127, 272, 184, 412, 464, 115, 172, 835]]


# Define list of HOSPITALS
hospitals_list = [Hosp(*row) for row in hospitals_array] #list


hosp_for_manu, hosp_for_cryo = within_shelflife(SHELF_LIFE)
# list of manufacturing locations that have at least one hospital within shelf_life
inactive_manu = [manu for manu in range(len(locations)) if manu not in list(hosp_for_manu.keys())]
#active_cryo = list[hosp_for_cryo.keys()]

def full_locations(a_dict):
    # adds missing locations from dictionary
    full_dict = dict.fromkeys(range(len(locations)), set())
    for loc in a_dict:
        full_dict[loc] = a_dict[loc]
        
    return full_dict

# add missing locations that have 0 hospitals within shelf life
hosp_for_manu = full_locations(hosp_for_manu)
hosp_for_cryo = full_locations(hosp_for_cryo)

# nr of hospitals in range for each (manufacturing) location
# manu_range = np.array([len(hosp_for_manu[manu]) for manu in range(len(locations))])

# nr of hospitals in range for each (cryo) location
cryo_range = np.array([len(hosp_for_cryo[cryo]) for cryo in range(len(locations))])

def non_zero_coverage(manu_list):
    for manu in manu_list:
        if manu not in inactive_manu:
            return True
    return False

pareto_front_100 = NSGAII(100)

final_df = pareto_front_coordinates(pareto_front_100)
final_df.to_csv('C:/Users/andre/OneDrive - UOM/Data/EVO_2021/pareto_front_locations.csv', index=False)

final_df[:10]